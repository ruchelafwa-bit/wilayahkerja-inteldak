<!DOCTYPE html>
    <html lang="id">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Wilayah Kerja Intelijen dan Penindakan Keimigrasian - Tanjungpinang</title>
        <script src="https://cdn.tailwindcss.com"></script>
            <script>
        // Cek apakah user sudah login
        if (localStorage.getItem('login') !== 'true') {
            // Jika belum login, redirect ke index.html
            window.location.href = 'index.html';
        }
        
        // Fungsi logout
        function logout() {
            if (confirm('Apakah Anda yakin ingin keluar?')) {
                localStorage.clear(); // Hapus semua data login
                window.location.href = 'index.html';
            }
        }
    </script>
        <style>
            .logo-glass {
    width: 64px;
    height: 64px;
    border-radius: 50%;
    padding: 4px;

    /* Ring emas */
    background: linear-gradient(
        135deg,
        #f9d976,
        #f39f1c,
        #d4af37,
        #f9d976
    );

    display: flex;
    align-items: center;
    justify-content: center;

    /* Efek glow lembut */
    box-shadow:
        0 0 15px rgba(212, 175, 55, 0.6),
        0 8px 20px rgba(0, 0, 0, 0.4);
}

.logo-glass img {
    width: 100%;
    height: 100%;
    border-radius: 50%;
    object-fit: contain;

    /* Efek kaca */
    background: rgba(255, 255, 255, 0.15);
    backdrop-filter: blur(6px);

    box-shadow:
        inset 0 0 12px rgba(255, 255, 255, 0.4);
}

/* Highlight glossy */
.logo-glass::after {
    content: "";
    position: absolute;
    width: 60%;
    height: 60%;
    top: 8px;
    left: 8px;
    border-radius: 50%;
    background: radial-gradient(
        circle,
        rgba(255,255,255,0.6),
        transparent 70%
    );
    pointer-events: none;
}

            * { margin: 0; padding: 0; box-sizing: border-box; }
            html { scroll-behavior: smooth; }
            body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; overflow-x: hidden; }

            @keyframes fadeInUp {
                from { opacity: 0; transform: translateY(30px); }
                to { opacity: 1; transform: translateY(0); }
            }

            @keyframes gentleFloat {
                0%, 100% { transform: translateY(0px); }
                50% { transform: translateY(-8px); }
            }

            @keyframes pulseGlow {
                0%, 100% { box-shadow: 0 0 20px rgba(59, 130, 246, 0.3); }
                50% { box-shadow: 0 0 40px rgba(59, 130, 246, 0.6); }
            }

            @keyframes floatParticle {
                0%, 100% { transform: translate(0, 0) rotate(0deg); opacity: 0.3; }
                50% { transform: translate(20px, -20px) rotate(180deg); opacity: 0.6; }
            }

            @keyframes slideDown {
                from {
                    opacity: 0;
                    max-height: 0;
                    transform: translateY(-20px);
                }
                to {
                    opacity: 1;
                    max-height: 1000px;
                    transform: translateY(0);
                }
            }

            @keyframes slideUp {
                from {
                    opacity: 1;
                    max-height: 1000px;
                    transform: translateY(0);
                }
                to {
                    opacity: 0;
                    max-height: 0;
                    transform: translateY(-20px);
                }
            }

            .fade-in-up { animation: fadeInUp 0.6s ease-out forwards; }
            .gentle-float { animation: gentleFloat 3s ease-in-out infinite; }
            .pulse-glow { animation: pulseGlow 2s ease-in-out infinite; }
            .particle { animation: floatParticle 8s ease-in-out infinite; }
            
            .city-content {
                animation: slideDown 0.5s cubic-bezier(0.4, 0, 0.2, 1) forwards;
                overflow: hidden;
            }

            .city-content.hiding {
                animation: slideUp 0.3s cubic-bezier(0.4, 0, 0.2, 1) forwards;
            }

            .glass {
                background: rgba(255, 255, 255, 0.9);
                backdrop-filter: blur(20px);
                border: 1px solid rgba(255, 255, 255, 0.3);
            }

.glass-dark {
    background: rgba(8, 47, 73, 0.75); /* biru imigrasi */
    backdrop-filter: blur(20px);
    border: 1px solid rgba(255, 255, 255, 0.1);
}

            .smooth-hover {
                transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            }

            .smooth-hover:hover {
                transform: translateY(-4px);
                box-shadow: 0 20px 40px rgba(0, 0, 0, 0.15);
            }

            .stat-card {
                position: relative;
                overflow: hidden;
                transition: all 0.5s cubic-bezier(0.4, 0, 0.2, 1);
            }

            .stat-card::before {
                content: '';
                position: absolute;
                top: 0;
                left: -100%;
                width: 100%;
                height: 100%;
                background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
                transition: left 0.6s ease;
            }

            .stat-card:hover::before { left: 100%; }

            .stat-card:hover {
                transform: translateY(-8px) scale(1.02);
                box-shadow: 0 25px 50px rgba(0, 0, 0, 0.2);
            }

            .input-modern {
                transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
                border: 2px solid #e5e7eb;
            }

            .input-modern:focus {
                border-color: #3b82f6;
                box-shadow: 0 0 0 4px rgba(59, 130, 246, 0.1);
                transform: translateY(-2px);
            }

            .input-modern:hover {
                border-color: #d1d5db;
                transform: translateY(-1px);
            }

            .btn-primary {
                background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
                position: relative;
                overflow: hidden;
            }

            .btn-primary::before {
                content: '';
                position: absolute;
                top: 0;
                left: -100%;
                width: 100%;
                height: 100%;
                background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
                transition: left 0.6s ease;
            }

            .btn-primary:hover::before { left: 100%; }

            .btn-primary:hover {
                transform: translateY(-3px) scale(1.02);
                box-shadow: 0 15px 35px rgba(102, 126, 234, 0.4);
            }

            .btn-primary:active {
                transform: translateY(-1px) scale(0.98);
            }

            .table-row {
                transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            }

            .table-row:hover {
                background: linear-gradient(90deg, rgba(59, 130, 246, 0.05), rgba(147, 51, 234, 0.05));
                transform: translateX(8px);
            }

            .district-card {
                transition: all 0.5s cubic-bezier(0.4, 0, 0.2, 1);
                position: relative;
                overflow: hidden;
            }

            .district-card::after {
                content: '';
                position: absolute;
                inset: 0;
                background: linear-gradient(45deg, transparent 30%, rgba(255,255,255,0.2) 50%, transparent 70%);
                transform: translateX(-100%) rotate(45deg);
                transition: transform 0.6s ease;
            }

            .district-card:hover::after { 
                transform: translateX(100%) rotate(45deg);
            }

            .district-card:hover {
                transform: translateY(-6px) scale(1.05);
                box-shadow: 0 20px 45px rgba(0, 0, 0, 0.3);
            }

            .district-card:active {
                transform: translateY(-2px) scale(1.02);
            }

            .city-button {
                transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            }

            .city-button:hover {
                transform: translateY(-4px);
                box-shadow: 0 15px 40px rgba(0, 0, 0, 0.25);
            }

            .city-button:active {
                transform: translateY(-2px);
            }

            .rotate-icon {
                transition: transform 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            }

            .rotate-icon.rotated {
                transform: rotate(180deg);
            }

            .modal-backdrop {
                backdrop-filter: blur(10px);
                animation: fadeIn 0.3s ease;
            }

            @keyframes fadeIn {
                from { opacity: 0; }
                to { opacity: 1; }
            }

            .modal-content {
                animation: scaleIn 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            }

            @keyframes scaleIn {
                from { opacity: 0; transform: scale(0.9) translateY(20px); }
                to { opacity: 1; transform: scale(1) translateY(0); }
            }

            .action-btn {
                transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            }

            .action-btn:hover {
                transform: translateY(-2px) scale(1.1);
            }

            .action-btn:active {
                transform: translateY(0) scale(0.95);
            }

            .hidden { display: none; }

            .form-section {
                transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            }

            .form-section:hover {
                transform: translateY(-2px);
                box-shadow: 0 8px 25px rgba(0, 0, 0, 0.08);
            }
            header .logo-glass::after {
    display: none;
}
       @keyframes matrix-rain {
            0% {
                transform: translateY(-100%);
                opacity: 1;
            }
            100% {
                transform: translateY(100vh);
                opacity: 0;
            }
        }


        </style>
    </head>
    <body class="bg-gradient-to-br from-slate-900 via-blue-900 to-slate-900 min-h-screen">

        <div class="fixed inset-0 -z-10">
            <div class="absolute inset-0 bg-cover bg-center" style="background-image: url('assets/imigrasi.jpg'); opacity: 0.15;"></div>
        </div>
        
        <div class="fixed inset-0 pointer-events-none overflow-hidden" style="z-index: 1;">
            <div class="particle absolute w-2 h-2 bg-blue-400/30 rounded-full" style="left: 10%; top: 20%;"></div>
            <div class="particle absolute w-3 h-3 bg-purple-400/30 rounded-full" style="left: 80%; top: 60%; animation-delay: 2s;"></div>
            <div class="particle absolute w-2 h-2 bg-pink-400/30 rounded-full" style="left: 30%; top: 70%; animation-delay: 4s;"></div>
            <div class="particle absolute w-3 h-3 bg-blue-400/30 rounded-full" style="left: 70%; top: 30%; animation-delay: 6s;"></div>
        </div>

<header class="glass-dark sticky top-0 z-50 shadow-2xl border-b border-white/10">
    <div class="container mx-auto px-6 py-4">
        <div class="flex items-center justify-between">
            <div class="flex items-center space-x-4">
                <div class="logo-glass">
                    <img src="assets/logo imigrasi.png" alt="Logo Imigrasi" />
                </div>
                <div class="leading-tight">
                    <h1 class="text-lg font-extrabold text-white uppercase tracking-wide">Wilayah Kerja</h1>
                    <p class="text-sm text-blue-300 font-semibold">Intelijen Dan Penindakan Keimigrasian</p>
                    <p class="text-xs text-gray-300 tracking-widest uppercase">Kantor Imigrasi Kelas I TPI Tanjungpinang</p>
                </div>
            </div>

                <!-- Logo Imigrasi -->
                <img src="assets/LOGO_IMIGRASI.png" alt="Logo Imigrasi" class="w-14 h-14 object-contain drop-shadow-lg" />
            </div>
        </div>
    </div>
</header>

        <nav class="glass-dark shadow-lg sticky top-[88px] z-40 border-b border-white/10">
            <div class="container mx-auto px-6">
                <div class="flex space-x-2">
                    <button onclick="showPage('dashboard')" id="nav-dashboard" class="nav-btn smooth-hover flex items-center space-x-2 px-6 py-4 font-semibold bg-gradient-to-r from-blue-600 to-blue-600 text-white rounded-t-lg">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path d="M4 5a1 1 0 011-1h4a1 1 0 011 1v7a1 1 0 01-1 1H5a1 1 0 01-1-1V5zM14 5a1 1 0 011-1h4a1 1 0 011 1v3a1 1 0 01-1 1h-4a1 1 0 01-1-1V5zM4 16a1 1 0 011-1h4a1 1 0 011 1v3a1 1 0 01-1 1H5a1 1 0 01-1-1v-3zM14 12a1 1 0 011-1h4a1 1 0 011 1v7a1 1 0 01-1 1h-4a1 1 0 01-1-1v-7z" stroke-width="2"/>
                        </svg>
                        <span>Dashboard</span>
                    </button>
                    <button onclick="showPage('input')" id="nav-input" class="nav-btn smooth-hover flex items-center space-x-2 px-6 py-4 font-semibold text-gray-300 hover:text-white hover:bg-white/10 rounded-t-lg">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path d="M12 4v16m8-8H4" stroke-width="2" stroke-linecap="round"/>
                        </svg>
                        <span>Input Data</span>
                    </button>
                    <button onclick="showPage('data')" id="nav-data" class="nav-btn smooth-hover flex items-center space-x-2 px-6 py-4 font-semibold text-gray-300 hover:text-white hover:bg-white/10 rounded-t-lg">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path d="M4 7v10c0 2.21 3.582 4 8 4s8-1.79 8-4V7M4 7c0 2.21 3.582 4 8 4s8-1.79 8-4M4 7c0-2.21 3.582-4 8-4s8 1.79 8 4" stroke-width="2"/>
                        </svg>
                        <span>Database</span>
                    </button>
                </div>
            </div>
        </nav>

        <main class="container mx-auto px-6 py-8 relative z-10">
            
            <div id="page-dashboard" class="page-content">
                <div class="space-y-8">
                    <div class="grid grid-cols-1 md:grid-cols-4 gap-6">
                        <div class="stat-card glass rounded-2xl p-6 fade-in-up">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-4xl font-bold text-blue-600" id="stat-total">0</p>
                                    <p class="text-sm text-gray-600 font-semibold mt-2">Total Data</p>
                                </div>
                                <div class="bg-gradient-to-br from-blue-500 to-blue-600 p-4 rounded-xl gentle-float">
                                    <svg class="w-10 h-10 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path d="M4 7v10c0 2.21 3.582 4 8 4s8-1.79 8-4V7M4 7c0 2.21 3.582 4 8 4s8-1.79 8-4M4 7c0-2.21 3.582-4 8-4s8 1.79 8 4" stroke-width="2"/>
                                    </svg>
                                </div>
                            </div>
                        </div>
                        <div class="stat-card glass rounded-2xl p-6 fade-in-up" style="animation-delay: 0.1s">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-4xl font-bold text-green-600" id="stat-tanjungpinang">0</p>
                                    <p class="text-sm text-gray-600 font-semibold mt-2">Tanjungpinang</p>
                                </div>
                                <div class="bg-gradient-to-br from-green-500 to-green-600 p-4 rounded-xl gentle-float" style="animation-delay: 0.5s">
                                    <svg class="w-10 h-10 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
                                             d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"/>
                                    </svg>
                                </div>
                            </div>
                        </div>
                        <div class="stat-card glass rounded-2xl p-6 fade-in-up" style="animation-delay: 0.2s">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-4xl font-bold text-blue-700" id="stat-bintan">0</p>
                                    <p class="text-sm text-gray-600 font-semibold mt-2">Bintan</p>
                                </div>
                                <div class="bg-gradient-to-br from-blue-600 to-blue-800 p-4 rounded-xl gentle-float" style="animation-delay: 1s">
                                    <svg class="w-10 h-10 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
                                          d="M12 3c-2.5 2-4 4.5-4 7m4-7c2.5 2 4 4.5 4 7M12 10v11M5 21h14M4 17c2-1 4-1 6 0s4 1 6 0 4-1 4 0"/>
                                    </svg>
                                </div>
                            </div>
                        </div>
                        <div class="stat-card glass rounded-2xl p-6 fade-in-up" style="animation-delay: 0.3s">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-4xl font-bold text-orange-600" id="stat-kota">2</p>
                                    <p class="text-sm text-gray-600 font-semibold mt-2">Wilayah</p>
                                </div>
                                <div class="bg-gradient-to-br from-orange-500 to-orange-600 p-4 rounded-xl gentle-float" style="animation-delay: 1.5s">
                                    <svg class="w-10 h-10 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z" stroke-width="2"/>
                                        <path d="M15 11a3 3 0 11-6 0 3 3 0 016 0z" stroke-width="2"/>
                                    </svg>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="glass rounded-3xl p-8 shadow-2xl fade-in-up" style="animation-delay: 0.4s">
                        <div class="flex items-center justify-between mb-6">
                            <div>
                                <h2 class="text-3xl font-bold text-gray-800">Peta Wilayah Kerja</h2>
                                <p class="text-gray-600 mt-1">Klik kartu untuk melihat detail data per wilayah</p>
                            </div>
                            <div class="px-6 py-3 bg-gradient-to-r from-blue-500 to-blue-600 rounded-xl text-white font-bold pulse-glow">
                                Kepulauan Riau
                            </div>
                        </div>
                        
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div class="bg-gradient-to-br from-emerald-500 to-teal-600 rounded-2xl shadow-xl overflow-hidden">
                                <button onclick="toggleCity('tanjungpinang')" class="city-button w-full p-6 text-white text-left">
                                    <div class="flex items-center justify-between mb-4">
                                        <div class="flex items-center space-x-4">
                                            <div class="bg-white/20 p-3 rounded-xl">
                                                <svg class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                    <path d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4" stroke-width="2"/>
                                                </svg>
                                            </div>
                                            <div>
                                                <p class="text-2xl font-bold">Tanjungpinang</p>
                                                <p class="text-emerald-100 text-sm">Kota</p>
                                            </div>
                                        </div>
                                        <div class="flex items-center space-x-3">
                                            <div class="bg-white text-emerald-600 px-5 py-2 rounded-full font-bold text-lg shadow-lg" id="count-tanjungpinang">0</div>
                                            <svg class="rotate-icon w-6 h-6" id="icon-tanjungpinang" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path d="M19 9l-7 7-7-7" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                            </svg>
                                        </div>
                                    </div>
                                </button>
                                
                                <div id="city-tanjungpinang" class="hidden">
                                    <div class="bg-white/10 p-6 city-content">
                                        <div class="grid grid-cols-2 gap-3" id="districts-tanjungpinang"></div>
                                    </div>
                                </div>
                            </div>

                            <div class="bg-gradient-to-br from-blue-500 to-indigo-600 rounded-2xl shadow-xl overflow-hidden">
                                <button onclick="toggleCity('bintan')" class="city-button w-full p-6 text-white text-left">
                                    <div class="flex items-center justify-between mb-4">
                                        <div class="flex items-center space-x-4">
                                            <div class="bg-white/20 p-3 rounded-xl">
                                                <svg class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                    <path d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6" stroke-width="2"/>
                                                </svg>
                                            </div>
                                            <div>
                                                <p class="text-2xl font-bold">Bintan</p>
                                                <p class="text-blue-100 text-sm">Kabupaten</p>
                                            </div>
                                        </div>
                                        <div class="flex items-center space-x-3">
                                            <div class="bg-white text-blue-600 px-5 py-2 rounded-full font-bold text-lg shadow-lg" id="count-bintan">0</div>
                                            <svg class="rotate-icon w-6 h-6" id="icon-bintan" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path d="M19 9l-7 7-7-7" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                            </svg>
                                        </div>
                                    </div>
                                </button>
                                
                                <div id="city-bintan" class="hidden">
                                    <div class="bg-white/10 p-6 city-content">
                                        <div class="grid grid-cols-2 gap-3" id="districts-bintan"></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div id="page-input" class="page-content hidden">
                <div class="glass rounded-3xl p-8 shadow-2xl max-w-5xl mx-auto fade-in-up">
                    <div class="flex items-center mb-8">
                        <div class="w-12 h-12 bg-gradient-to-br from-green-500 to-emerald-600 rounded-xl flex items-center justify-center mr-4 gentle-float">
                            <svg class="w-7 h-7 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z" stroke-width="2"/>
                            </svg>
                        </div>
                        <div>
                            <h2 class="text-3xl font-bold text-gray-800" id="form-title">Input Data Warga Negara Asing</h2>
                            <p class="text-gray-600 text-sm mt-1">Lengkapi formulir dengan data yang akurat</p>
                        </div>
                    </div>
                    
                    <form id="data-form" class="space-y-6">
                        <div class="form-section bg-gradient-to-r from-blue-50 to-blue-60 rounded-2xl p-6">
                            <h3 class="text-lg font-bold text-gray-700 mb-4 flex items-center">
                                <svg class="w-5 h-5 mr-2 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" stroke-width="2"/>
                                </svg>
                                Data Identitas
                            </h3>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div>
                                    <label class="block text-sm font-semibold text-gray-700 mb-2">Nama Lengkap <span class="text-red-500">*</span></label>
                                    <input type="text" id="nama" required class="input-modern w-full px-4 py-3 rounded-xl focus:outline-none bg-white">
                                </div>
                                <div>
                                    <label class="block text-sm font-semibold text-gray-700 mb-2">Nomor Paspor <span class="text-red-500">*</span></label>
                                    <input type="text" id="paspor" required class="input-modern w-full px-4 py-3 rounded-xl focus:outline-none bg-white">
                                </div>
                                <div>
                                    <label class="block text-sm font-semibold text-gray-700 mb-2">Negara Asal <span class="text-red-500">*</span></label>
                                    <input 
                                        type="text" 
                                        id="negara" 
                                        required 
                                        list="negara-list"
                                        placeholder="Ketik nama negara..."
                                        class="input-modern w-full px-4 py-3 rounded-xl focus:outline-none bg-white"
                                        autocomplete="off">
                                    <datalist id="negara-list">
                                        <option value="Indonesia">
                                        <option value="Singapura">
                                        <option value="Malaysia">
                                        <option value="Thailand">
                                        <option value="Vietnam">
                                        <option value="Filipina">
                                        <option value="Brunei Darussalam">
                                        <option value="Myanmar">
                                        <option value="Laos">
                                        <option value="Kamboja">
                                        <option value="Tiongkok">
                                        <option value="Jepang">
                                        <option value="Korea Selatan">
                                        <option value="Korea Utara">
                                        <option value="India">
                                        <option value="Pakistan">
                                        <option value="Bangladesh">
                                        <option value="Sri Lanka">
                                        <option value="Nepal">
                                        <option value="Arab Saudi">
                                        <option value="Uni Emirat Arab">
                                        <option value="Qatar">
                                        <option value="Kuwait">
                                        <option value="Oman">
                                        <option value="Bahrain">
                                        <option value="Yordania">
                                        <option value="Turki">
                                        <option value="Iran">
                                        <option value="Irak">
                                        <option value="Israel">
                                        <option value="Palestina">
                                        <option value="Mesir">
                                        <option value="Libya">
                                        <option value="Tunisia">
                                        <option value="Aljazair">
                                        <option value="Maroko">
                                        <option value="Sudan">
                                        <option value="Nigeria">
                                        <option value="Kenya">
                                        <option value="Tanzania">
                                        <option value="Uganda">
                                        <option value="Ethiopia">
                                        <option value="Ghana">
                                        <option value="Afrika Selatan">
                                        <option value="Amerika Serikat">
                                        <option value="Kanada">
                                        <option value="Meksiko">
                                        <option value="Brasil">
                                        <option value="Argentina">
                                        <option value="Chili">
                                        <option value="Kolombia">
                                        <option value="Peru">
                                        <option value="Venezuela">
                                        <option value="Inggris">
                                        <option value="Prancis">
                                        <option value="Jerman">
                                        <option value="Italia">
                                        <option value="Spanyol">
                                        <option value="Belanda">
                                        <option value="Belgia">
                                        <option value="Swiss">
                                        <option value="Austria">
                                        <option value="Swedia">
                                        <option value="Norwegia">
                                        <option value="Denmark">
                                        <option value="Finlandia">
                                        <option value="Polandia">
                                        <option value="Rusia">
                                        <option value="Ukraina">
                                        <option value="Yunani">
                                        <option value="Portugal">
                                        <option value="Irlandia">
                                        <option value="Australia">
                                        <option value="Selandia Baru">
                                        <option value="Papua Nugini">
                                        <option value="Fiji">
                                    </datalist>
                                </div>
                                <div>
                                    <label class="block text-sm font-semibold text-gray-700 mb-2">Jenis Izin Tinggal <span class="text-red-500">*</span></label>
                                    <select id="jenisIzin" required class="input-modern w-full px-4 py-3 rounded-xl focus:outline-none bg-white">
                                        <option value="">Pilih Jenis Izin Tinggal</option>
                                        <option value="KITAS">KITAS (Kartu Izin Tinggal Terbatas)</option>
                                        <option value="KITAP">KITAP (Kartu Izin Tinggal Tetap)</option>
                                        <option value="Visa Kunjungan">Visa Kunjungan</option>
                                        <option value="Visa Diplomatik">Visa Diplomatik</option>
                                        <option value="Visa Dinas">Visa Dinas</option>
                                        <option value="KTP">KTP (Warga Negara Indonesia)</option>
                                        <option value="Lainnya">Lainnya</option>
                                    </select>
                                </div>
                                <div>
                                    <label class="block text-sm font-semibold text-gray-700 mb-2">Penjamin <span class="text-red-500">*</span></label>
                                    <input type="text" id="penjamin" required class="input-modern w-full px-4 py-3 rounded-xl focus:outline-none bg-white">
                                </div>
                                <div>
                                    <label class="block text-sm font-semibold text-gray-700 mb-2">Tanggal Lahir <span class="text-red-500">*</span></label>
                                    <input type="date" id="tanggalLahir" required class="input-modern w-full px-4 py-3 rounded-xl focus:outline-none bg-white">
                                </div>
                                <div>
                                    <label class="block text-sm font-semibold text-gray-700 mb-2">Jenis Kelamin <span class="text-red-500">*</span></label>
                                    <select id="jenisKelamin" required class="input-modern w-full px-4 py-3 rounded-xl focus:outline-none bg-white">
                                        <option value="">Pilih Jenis Kelamin</option>
                                        <option value="Laki-laki">Laki-laki</option>
                                        <option value="Perempuan">Perempuan</option>
                                    </select>
                                </div>
                            </div>
                        </div>

                        <div class="form-section bg-gradient-to-r from-green-50 to-teal-50 rounded-2xl p-6">
                            <h3 class="text-lg font-bold text-gray-700 mb-4 flex items-center">
                                <svg class="w-5 h-5 mr-2 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z" stroke-width="2"/>
                                    <path d="M15 11a3 3 0 11-6 0 3 3 0 016 0z" stroke-width="2"/>
                                </svg>
                                Data Lokasi
                            </h3>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div>
                                    <label class="block text-sm font-semibold text-gray-700 mb-2">Kota/Kabupaten <span class="text-red-500">*</span></label>
                                    <select id="kota" required class="input-modern w-full px-4 py-3 rounded-xl focus:outline-none bg-white">
                                        <option value="">Pilih Kota</option>
                                        <option value="Tanjungpinang">Tanjungpinang</option>
                                        <option value="Bintan">Bintan</option>
                                    </select>
                                </div>
                                <div>
                                    <label class="block text-sm font-semibold text-gray-700 mb-2">Kecamatan <span class="text-red-500">*</span></label>
                                    <select id="kecamatan" required class="input-modern w-full px-4 py-3 rounded-xl focus:outline-none bg-white">
                                        <option value="">Pilih Kecamatan</option>
                                    </select>
                                </div>
                                <div>
                                    <label class="block text-sm font-semibold text-gray-700 mb-2">Kelurahan/Desa</label>
                                    <input type="text" id="kelurahan" class="input-modern w-full px-4 py-3 rounded-xl focus:outline-none bg-white">
                                </div>
                                <div class="md:col-span-2">
                                    <label class="block text-sm font-semibold text-gray-700 mb-2">Alamat Lengkap</label>
                                    <textarea id="alamat" rows="3" class="input-modern w-full px-4 py-3 rounded-xl focus:outline-none bg-white"></textarea>
                                </div>
                            </div>
                        </div>

                        <div class="flex space-x-4">
                            <button type="submit" class="btn-primary flex-1 text-white font-bold py-4 px-6 rounded-xl shadow-lg">
                                <span id="submit-text">üíæ Simpan Data</span>
                            </button>
                            <button type="button" id="cancel-btn" onclick="cancelEdit()" class="smooth-hover flex-1 bg-gray-500 hover:bg-gray-600 text-white font-bold py-4 px-6 rounded-xl shadow-lg hidden">
                                ‚úñÔ∏è Batal
                            </button>
                        </div>
                    </form>
                </div>
            </div>

            <div id="page-data" class="page-content hidden">
                <div class="glass rounded-3xl p-8 shadow-2xl fade-in-up">
                    <div class="flex flex-col md:flex-row justify-between items-start md:items-center gap-4 mb-6">
                        <div class="flex items-center">
                            <div class="w-12 h-12 bg-gradient-to-br from-blue-600 to-blue-700 rounded-xl flex items-center justify-center mr-4 gentle-float">
                                <svg class="w-7 h-7 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path d="M4 7v10c0 2.21 3.582 4 8 4s8-1.79 8-4V7M4 7c0 2.21 3.582 4 8 4s8-1.79 8-4M4 7c0-2.21 3.582-4 8-4s8 1.79 8 4" stroke-width="2"/>
                                </svg>
                            </div>
                            <div>
                                <h2 class="text-3xl font-bold text-gray-800">Database Intelijen</h2>
                                <p class="text-gray-600 text-sm mt-1">Kelola dan pantau seluruh data subjek</p>
                            </div>
                        </div>
                        <button onclick="exportCSV()" class="btn-primary flex items-center space-x-2 text-white px-6 py-3 rounded-xl shadow-lg">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4" stroke-width="2"/>
                            </svg>
                            <span>Export CSV</span>
                        </button>
                    </div>
                    
                    <div class="mb-6">
                        <div class="relative">
                            <svg class="absolute left-4 top-1/2 transform -translate-y-1/2 text-gray-400 w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <circle cx="11" cy="11" r="8" stroke-width="2"/>
                                <path d="M21 21l-4.35-4.35" stroke-width="2"/>
                            </svg>
                            <input type="text" id="search-input" onkeyup="searchData()" placeholder="Cari berdasarkan nama, paspor, atau lokasi..." class="input-modern w-full pl-12 pr-4 py-4 rounded-xl focus:outline-none bg-white shadow-sm">
                        </div>
                    </div>

                    <div class="bg-white rounded-2xl overflow-hidden shadow-lg">
                        <div class="overflow-x-auto">
                            <table class="w-full">
                                <thead class="bg-gradient-to-r from-blue-600 to-blue-800 text-white">
                                    <tr>
                                        <th class="px-4 py-4 text-left font-bold">No</th>
                                        <th class="px-4 py-4 text-left font-bold">Nama</th>
                                        <th class="px-4 py-4 text-left font-bold">Paspor</th>
                                        <th class="px-4 py-4 text-left font-bold">Negara</th>
                                        <th class="px-4 py-4 text-left font-bold">Izin Tinggal</th>
                                        <th class="px-4 py-4 text-left font-bold">Kota</th>
                                        <th class="px-4 py-4 text-center font-bold">Aksi</th>
                                    </tr>
                                </thead>
                                <tbody id="data-table-body"></tbody>
                            </table>
                        </div>
                        <div id="no-data" class="text-center py-16 hidden">
                            <div class="inline-block p-6 bg-gray-100 rounded-full mb-4">
                                <svg class="w-16 h-16 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path d="M20 13V6a2 2 0 00-2-2H6a2 2 0 00-2 2v7m16 0v5a2 2 0 01-2 2H6a2 2 0 01-2-2v-5m16 0h-2.586a1 1 0 00-.707.293l-2.414 2.414a1 1 0 01-.707.293h-3.172a1 1 0 01-.707-.293l-2.414-2.414A1 1 0 006.586 13H4" stroke-width="2"/>
                                </svg>
                            </div>
                            <p class="text-xl font-bold text-gray-700">Tidak ada data ditemukan</p>
                            <p class="text-sm text-gray-500 mt-2">Coba ubah kata kunci pencarian Anda</p>
                        </div>
                    </div>
                </div>
            </div>
        </main>

        <div id="modal-detail" class="fixed inset-0 modal-backdrop bg-black/50 flex items-center justify-center z-50 p-4 hidden">
            <div class="modal-content bg-white rounded-3xl shadow-2xl max-w-3xl w-full max-h-[90vh] overflow-y-auto">
                <div class="bg-gradient-to-r from-blue-600 to-blue-800 text-white p-6 sticky top-0 rounded-t-3xl">
                    <div class="flex justify-between items-center">
                        <h3 class="text-2xl font-bold">üìã Detail Data Subjek</h3>
                        <button onclick="closeModal()" class="smooth-hover bg-white/20 hover:bg-white/30 rounded-full w-10 h-10 flex items-center justify-center">
                            <span class="text-2xl">√ó</span>
                        </button>
                    </div>
                </div>
                <div class="p-6 space-y-6" id="modal-content"></div>
            </div>
        </div>

        <footer class="glass-dark text-white py-6 mt-12 border-t border-white/10">
            <div class="container mx-auto px-6 text-center">
                <p class="font-semibold">üõ°Ô∏è Sistem Informasi Intelijen Keamanan Wilayah</p>
                <p class="text-sm text-blue-300 mt-1">Kantor Imigrasi - Kepala Seksi INTELDALKIM</p>
                <p class="text-xs text-gray-400 mt-2">¬© 2025 - Kantor Imigrasi Kelas I TPI Tanjungpinang</p>
            </div>
        </footer>
    <script>
let dataList = [];
let editingId = null;
const API_BASE = '/api/proxy?endpoint=';

const regions = {   
    'Tanjungpinang': ['Tanjungpinang Kota', 'Tanjungpinang Barat', 'Tanjungpinang Timur', 'Bukit Bestari'],
    'Bintan': ['Teluk Bintan', 'Bintan Timur', 'Gunung Kijang', 'Bintan Pesisir', 'Mantang', 'Tambelan', 'Toapaya']
};

async function loadData() {
    try {
        console.log('üîÑ Loading data via proxy...');
        
        const response = await fetch(API_BASE + 'get_data.php', {
            method: 'GET',
            headers: {
                'Content-Type': 'application/json'
            }
        });
        
        console.log('üì° Response status:', response.status);
        
        if (!response.ok) {
            throw new Error(`HTTP ${response.status}`);
        }
        
        const result = await response.json();
        console.log('‚úÖ Data received:', result);
        
        if (result.success) {
            dataList = result.data || [];
            console.log('‚úÖ Total records:', dataList.length);
            renderTable();
            renderDistrictCards();
            updateStatistics();
        } else {
            throw new Error(result.message);
        }
        
    } catch (error) {
        console.error('‚ùå Error:', error);
        alert('‚ö†Ô∏è Gagal memuat data: ' + error.message);
        dataList = [];
        renderTable();
        updateStatistics();
    }
}

async function saveDataToServer(formData) {
    try {
        const response = await fetch(API_BASE + 'save_data.php', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(formData)
        });
        
        const result = await response.json();
        
        if (result.success) {
            console.log('‚úÖ Data saved:', result.data);
            return result.data;
        } else {
            throw new Error(result.message);
        }
    } catch (error) {
        console.error('‚ùå Error saving data:', error);
        throw error;
    }
}

async function deleteDataFromServer(id) {
    try {
        const response = await fetch(API_BASE + 'delete_data.php', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ id: id })
        });
        
        const result = await response.json();
        
        if (result.success) {
            console.log('‚úÖ Data deleted');
            return true;
        } else {
            throw new Error(result.message);
        }
    } catch (error) {
        console.error('‚ùå Error deleting data:', error);
        throw error;
    }
}

document.addEventListener('DOMContentLoaded', async function() {
    await loadData();
    renderDistrictCards();
    renderTable();
    updateStatistics();
    setupKotaListener();
});

document.getElementById('data-form').addEventListener('submit', async function(e) {
    e.preventDefault();
    
    const negaraInput = document.getElementById('negara').value;
    const status = negaraInput === 'Indonesia' ? 'WNI' : 'WNA';
    
    const formData = {
        nama: document.getElementById('nama').value,
        paspor: document.getElementById('paspor').value,
        negara: negaraInput,
        status: status,
        jenisIzin: document.getElementById('jenisIzin').value,
        penjamin: document.getElementById('penjamin').value,
        tanggalLahir: document.getElementById('tanggalLahir').value,
        jenisKelamin: document.getElementById('jenisKelamin').value,
        kota: document.getElementById('kota').value,
        kecamatan: document.getElementById('kecamatan').value,
        kelurahan: document.getElementById('kelurahan').value,
        alamat: document.getElementById('alamat').value
    };
    
    if (editingId) {
        formData.id = editingId;
    }
    
    try {
        // Save to server
        const saved = await saveDataToServer(formData);
        
        // Update local data
        if (editingId) {
            const index = dataList.findIndex(item => item.id === editingId);
            dataList[index] = { ...formData, id: editingId };
            editingId = null;
        } else {
            formData.id = saved.id;
            dataList.push(formData);
        }
        
        resetForm();
        renderTable();
        renderDistrictCards();
        updateStatistics();
        showPage('data');
        alert('‚úÖ Data berhasil disimpan!');
        
    } catch (error) {
        alert('‚ùå Gagal menyimpan data: ' + error.message);
    }
});

// ==========================================
// FUNGSI DELETE DATA
// ==========================================
async function deleteData(id) {
    if (confirm('‚ö†Ô∏è Apakah Anda yakin ingin menghapus data ini?')) {
        try {
            await deleteDataFromServer(id);
            
            dataList = dataList.filter(item => item.id !== id);
            renderTable();
            renderDistrictCards();
            updateStatistics();
            alert('üóëÔ∏è Data berhasil dihapus!');
            
        } catch (error) {
            alert('‚ùå Gagal menghapus data: ' + error.message);
        }
    }
}

// ==========================================
// FUNGSI NAVIGASI & UI
// ==========================================
function showPage(page) {
    document.querySelectorAll('.page-content').forEach(p => p.classList.add('hidden'));
    document.querySelectorAll('.nav-btn').forEach(btn => {
        btn.classList.remove('bg-gradient-to-r', 'from-blue-600', 'to-blue-800', 'text-white');
        btn.classList.add('text-gray-300');
    });

    document.getElementById('page-' + page).classList.remove('hidden');
    const navBtn = document.getElementById('nav-' + page);
    navBtn.classList.add('bg-gradient-to-r', 'from-blue-600', 'to-blue-800', 'text-white');
    navBtn.classList.remove('text-gray-300');

    if (page === 'data') {
        document.getElementById('search-input').value = '';
        renderTable(dataList);
    }
}

function toggleCity(city) {
    const content = document.getElementById('city-' + city);
    const icon = document.getElementById('icon-' + city);
    
    if (content.classList.contains('hidden')) {
        content.classList.remove('hidden');
        icon.classList.add('rotated');
    } else {
        content.classList.add('hidden');
        icon.classList.remove('rotated');
    }
}

// ==========================================
// RENDER DISTRICT CARDS
// ==========================================
function renderDistrictCards() {
    Object.keys(regions).forEach(city => {
        const container = document.getElementById('districts-' + city.toLowerCase());
        container.innerHTML = '';
        
        regions[city].forEach(district => {
            const count = dataList.filter(item => item.kota === city && item.kecamatan === district).length;
            const card = document.createElement('button');
            card.onclick = () => filterByDistrict(city, district);
            card.className = 'district-card bg-gradient-to-br from-white/80 to-white/60 backdrop-blur-sm text-gray-800 p-4 rounded-xl shadow-lg';
            card.innerHTML = `
                <div class="flex items-center justify-between mb-2">
                    <div class="bg-gradient-to-br from-yellow-400 to-orange-500 p-2 rounded-lg gentle-float">
                        <svg class="w-5 h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z" stroke-width="2"/>
                            <path d="M15 11a3 3 0 11-6 0 3 3 0 016 0z" stroke-width="2"/>
                        </svg>
                    </div>
                    <div class="bg-gradient-to-r from-orange-500 to-red-500 text-white px-3 py-1 rounded-full text-sm font-bold shadow-lg">${count}</div>
                </div>
                <p class="font-bold text-left text-sm mb-2">${district}</p>
                <div class="w-full h-2 bg-gray-200 rounded-full overflow-hidden">
                    <div class="h-full bg-gradient-to-r from-orange-400 to-red-500 rounded-full transition-all duration-500" style="width: ${Math.min(count * 20, 100)}%"></div>
                </div>
            `;
            container.appendChild(card);
        });

        document.getElementById('count-' + city.toLowerCase()).textContent = dataList.filter(item => item.kota === city).length;
    });
}

function filterByDistrict(city, district) {
    const filtered = dataList.filter(d => d.kota === city && d.kecamatan === district);
    showPage('data');
    renderTable(filtered);
}

// ==========================================
// SETUP KOTA LISTENER
// ==========================================
function setupKotaListener() {
    document.getElementById('kota').addEventListener('change', function() {
        const kecamatanSelect = document.getElementById('kecamatan');
        kecamatanSelect.innerHTML = '<option value="">Pilih Kecamatan</option>';
        if (this.value && regions[this.value]) {
            regions[this.value].forEach(district => {
                const option = document.createElement('option');
                option.value = district;
                option.textContent = district;
                kecamatanSelect.appendChild(option);
            });
        }
    });
}

// ==========================================
// RESET FORM
// ==========================================
function resetForm() {
    document.getElementById('data-form').reset();
    document.getElementById('form-title').textContent = 'Input Data Warga Negara Asing';
    document.getElementById('submit-text').textContent = 'üíæ Simpan Data';
    document.getElementById('cancel-btn').classList.add('hidden');
    editingId = null;
}

function cancelEdit() {
    resetForm();
}

// ==========================================
// RENDER TABLE
// ==========================================
function renderTable(filteredList = null) {
    const list = filteredList || dataList;
    const tbody = document.getElementById('data-table-body');
    const noData = document.getElementById('no-data');
    tbody.innerHTML = '';

    if (list.length === 0) {
        noData.classList.remove('hidden');
        return;
    }

    noData.classList.add('hidden');

    list.forEach((item, index) => {
        const row = document.createElement('tr');
        row.className = `table-row border-b ${index % 2 === 0 ? 'bg-gray-50' : 'bg-white'}`;
        row.innerHTML = `
            <td class="px-4 py-4 font-semibold">${index + 1}</td>
            <td class="px-4 py-4 font-semibold">${item.nama}</td>
            <td class="px-4 py-4 font-mono text-sm">${item.paspor}</td>
            <td class="px-4 py-4 text-sm">${item.negara || '-'}</td>
            <td class="px-4 py-4 text-sm">${item.jenisIzin || '-'}</td>
            <td class="px-4 py-4">${item.kota}</td>
            <td class="px-4 py-4">
                <div class="flex justify-center space-x-2">
                    <button onclick="viewDetail(${item.id})" class="action-btn bg-blue-500 hover:bg-blue-600 text-white p-2 rounded-lg shadow" title="Lihat Detail">
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" stroke-width="2"/>
                            <path d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z" stroke-width="2"/>
                        </svg>
                    </button>
                    <button onclick="editData(${item.id})" class="action-btn bg-green-500 hover:bg-green-600 text-white p-2 rounded-lg shadow" title="Edit">
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z" stroke-width="2"/>
                        </svg>
                    </button>
                    <button onclick="deleteData(${item.id})" class="action-btn bg-red-500 hover:bg-red-600 text-white p-2 rounded-lg shadow" title="Hapus">
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" stroke-width="2"/>
                        </svg>
                    </button>
                </div>
            </td>
        `;
        tbody.appendChild(row);
    });
}

// ==========================================
// SEARCH DATA
// ==========================================
function searchData() {
    const searchTerm = document.getElementById('search-input').value.toLowerCase();
    const filtered = dataList.filter(item =>
        item.nama.toLowerCase().includes(searchTerm) ||
        item.paspor.toLowerCase().includes(searchTerm) ||
        item.kota.toLowerCase().includes(searchTerm) ||
        item.kecamatan.toLowerCase().includes(searchTerm) ||
        (item.jenisIzin && item.jenisIzin.toLowerCase().includes(searchTerm))
    );
    renderTable(filtered);
}

// ==========================================
// EDIT DATA
// ==========================================
function editData(id) {
    const item = dataList.find(d => d.id === id);
    if (!item) return;

    editingId = id;
    document.getElementById('nama').value = item.nama;
    document.getElementById('paspor').value = item.paspor;
    document.getElementById('negara').value = item.negara || '';
    document.getElementById('jenisIzin').value = item.jenisIzin || '';
    document.getElementById('penjamin').value = item.penjamin;
    document.getElementById('tanggalLahir').value = item.tanggalLahir;
    document.getElementById('jenisKelamin').value = item.jenisKelamin;
    document.getElementById('kota').value = item.kota;
    document.getElementById('kota').dispatchEvent(new Event('change'));
    setTimeout(() => { document.getElementById('kecamatan').value = item.kecamatan; }, 100);
    document.getElementById('kelurahan').value = item.kelurahan || '';
    document.getElementById('alamat').value = item.alamat || '';
    document.getElementById('form-title').textContent = 'Edit Data';
    document.getElementById('submit-text').textContent = '‚úèÔ∏è Update Data';
    document.getElementById('cancel-btn').classList.remove('hidden');
    showPage('input');
}

// ==========================================
// VIEW DETAIL
// ==========================================
function viewDetail(id) {
    const item = dataList.find(d => d.id === id);
    if (!item) return;

    const statusClass = item.status === 'WNI' ? 'bg-green-100 text-green-700' : 'bg-blue-100 text-blue-700';
    const content = `
        <div class="bg-gradient-to-r from-blue-50 to-blue-100 rounded-2xl p-6 mb-4">
            <h4 class="text-lg font-bold text-gray-700 mb-4 flex items-center">
                <svg class="w-5 h-5 mr-2 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" stroke-width="2"/>
                </svg>
                Data Identitas
            </h4>
            <div class="grid grid-cols-2 gap-4">
                <div><p class="text-sm text-gray-500">Nama Lengkap</p><p class="font-semibold text-gray-800">${item.nama}</p></div>
                <div><p class="text-sm text-gray-500">Nomor Paspor</p><p class="font-semibold text-gray-800">${item.paspor}</p></div>
                <div><p class="text-sm text-gray-500">Negara Asal</p><p class="font-semibold text-gray-800">${item.negara || '-'}</p></div>
                <div><p class="text-sm text-gray-500">Status Kewarganegaraan</p><span class="inline-block px-3 py-1 rounded-full text-xs font-bold ${statusClass}">${item.status}</span></div>
                <div><p class="text-sm text-gray-500">Jenis Izin Tinggal</p><p class="font-semibold text-gray-800">${item.jenisIzin || '-'}</p></div>
                <div><p class="text-sm text-gray-500">Penjamin</p><p class="font-semibold text-gray-800">${item.penjamin}</p></div>
                <div><p class="text-sm text-gray-500">Tanggal Lahir</p><p class="font-semibold text-gray-800">${item.tanggalLahir}</p></div>
                <div><p class="text-sm text-gray-500">Jenis Kelamin</p><p class="font-semibold text-gray-800">${item.jenisKelamin}</p></div>
            </div>
        </div>
        <div class="bg-gradient-to-r from-green-50 to-teal-50 rounded-2xl p-6 mb-6">
            <h4 class="text-lg font-bold text-gray-700 mb-4 flex items-center">
                <svg class="w-5 h-5 mr-2 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z" stroke-width="2"/>
                    <path d="M15 11a3 3 0 11-6 0 3 3 0 016 0z" stroke-width="2"/>
                </svg>
                Data Lokasi
            </h4>
            <div class="grid grid-cols-2 gap-4">
                <div><p class="text-sm text-gray-500">Kota/Kabupaten</p><p class="font-semibold text-gray-800">${item.kota}</p></div>
                <div><p class="text-sm text-gray-500">Kecamatan</p><p class="font-semibold text-gray-800">${item.kecamatan}</p></div>
                <div><p class="text-sm text-gray-500">Kelurahan/Desa</p><p class="font-semibold text-gray-800">${item.kelurahan || '-'}</p></div>
                <div class="col-span-2"><p class="text-sm text-gray-500">Alamat Lengkap</p><p class="font-semibold text-gray-800">${item.alamat || '-'}</p></div>
            </div>
        </div>
        <div class="flex space-x-4">
            <button onclick="editData(${item.id}); closeModal();" class="btn-primary flex-1 text-white font-bold py-3 px-6 rounded-xl">‚úèÔ∏è Edit Data</button>
            <button onclick="closeModal()" class="smooth-hover flex-1 bg-gray-500 hover:bg-gray-600 text-white font-bold py-3 px-6 rounded-xl">‚úñÔ∏è Tutup</button>
        </div>
    `;

    document.getElementById('modal-content').innerHTML = content;
    document.getElementById('modal-detail').classList.remove('hidden');
}

function closeModal() {
    document.getElementById('modal-detail').classList.add('hidden');
}

// ==========================================
// UPDATE STATISTICS
// ==========================================
function updateStatistics() {
    document.getElementById('stat-total').textContent = dataList.length;
    document.getElementById('stat-tanjungpinang').textContent = dataList.filter(d => d.kota === 'Tanjungpinang').length;
    document.getElementById('stat-bintan').textContent = dataList.filter(d => d.kota === 'Bintan').length;
}

// ==========================================
// EXPORT CSV - FIXED! (Hapus double comma)
// ==========================================
function exportCSV() {
    const headers = ['Nama', 'Paspor', 'Negara Asal', 'Jenis Izin Tinggal', 'Penjamin', 'Tanggal Lahir', 'Jenis Kelamin', 'Kota', 'Kecamatan', 'Kelurahan', 'Alamat'];
    const rows = dataList.map(d => [
        d.nama, 
        d.paspor, 
        d.negara || '', 
        d.jenisIzin || '', 
        d.penjamin, 
        d.tanggalLahir,  // FIX: Hapus double comma di sini!
        d.jenisKelamin, 
        d.kota, 
        d.kecamatan, 
        d.kelurahan || '', 
        d.alamat || ''
    ]);
    const csv = [headers, ...rows].map(row => row.join(',')).join('\n');
    const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = 'data-intelijen-imigrasi.csv';
    a.click();
    URL.revokeObjectURL(url);
}
</script>
    </body>

    </html>     






